<!DOCTYPE html>
<html><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Predicados de busca em Arrays com um antigo vilão, o `this` - Eduardo</title><link rel="icon" type="image/png" href="http://localhost:1313//favicon.png" /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="A primeira postagem é especial, então escrevi ouvindo este álbum maravilhoso do Kevin.
Prefácio
É, o this é odiado entre quase todos os devs do javascripto, talvez seja o elemento mais odiado e se você ainda não odeia, ainda vai odiar. A razão é bem conhecida, seu comportamento e valor é meio estranho, assim como todo JS, mas ele em especial pois depende do contexto que se encontra, ou seja, do objeto que está em execução naquele momento. Vejamos alguns exemplos:" /><meta property="og:image" content="http://localhost:1313//thumbs/predicados-em-arrays-com-um-antigo-vilao-o-this.png" /><meta property="og:url" content="http://localhost:1313/posts/predicados-em-arrays-com-um-antigo-vilao-o-this/">
  <meta property="og:site_name" content="Eduardo">
  <meta property="og:title" content="Predicados de busca em Arrays com um antigo vilão, o `this`">
  <meta property="og:description" content="A primeira postagem é especial, então escrevi ouvindo este álbum maravilhoso do Kevin.
Prefácio É, o this é odiado entre quase todos os devs do javascripto, talvez seja o elemento mais odiado e se você ainda não odeia, ainda vai odiar. A razão é bem conhecida, seu comportamento e valor é meio estranho, assim como todo JS, mas ele em especial pois depende do contexto que se encontra, ou seja, do objeto que está em execução naquele momento. Vejamos alguns exemplos:">
  <meta property="og:locale" content="pt_BR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-11-17T23:19:30-03:00">
    <meta property="article:modified_time" content="2022-11-17T23:19:30-03:00">
    <meta property="article:tag" content="Javascript, Performance">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Predicados de busca em Arrays com um antigo vilão, o `this`">
  <meta name="twitter:description" content="A primeira postagem é especial, então escrevi ouvindo este álbum maravilhoso do Kevin.
Prefácio É, o this é odiado entre quase todos os devs do javascripto, talvez seja o elemento mais odiado e se você ainda não odeia, ainda vai odiar. A razão é bem conhecida, seu comportamento e valor é meio estranho, assim como todo JS, mas ele em especial pois depende do contexto que se encontra, ou seja, do objeto que está em execução naquele momento. Vejamos alguns exemplos:">

	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/main.0b3c61b1f158d6c8d4cc6e654b06d23f198ed4ce2487bb05c9717166f9688ef8.css" />

	
	
</head>
<body>
        <div class="content"><header>
	<a href="http://localhost:1313/" class="header-logo">eduardo<span>.</span></a>
	<nav>
		
		<a href="/posts">blog</a>
		
		<a href="https://linkedin.com/in/euduardoborges" target="_blank">linkedin</a>
		<a href="https://github.com/eduardoborges" target="_blank">github</a>
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1>Predicados de busca em Arrays com um antigo vilão, o `this`</h1>
			<div class="meta">postado em Nov 17, 2022</div>
			<small>
			compartilhe no
			<a href="https://www.linkedin.com/sharing/share-offsite/?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fpredicados-em-arrays-com-um-antigo-vilao-o-this%2f" target="_blank">linkedin</a>
			ou na
			<a href="http://twitter.com/share?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fpredicados-em-arrays-com-um-antigo-vilao-o-this%2f" target="_blank">rede do ellon musk</a>
			</small>
		</div>

		

		<section class="body">
			<p><em>A primeira postagem é especial, então escrevi ouvindo <a href="https://open.spotify.com/album/79dL7FLiJFOO0EoehUHQBv?si=xNdnkscPStmVMW-TD2i7-w">este álbum maravilhoso</a> do Kevin.</em></p>
<h2 id="prefácio">Prefácio</h2>
<p>É, o <code>this</code> é odiado entre quase todos os <em>devs</em> do <em>javascripto</em>, talvez seja o elemento mais odiado e se você ainda não odeia, ainda vai odiar. A razão é bem conhecida, seu comportamento e valor é meio estranho, assim como todo JS, mas ele em especial pois <a href="https://www.30secondsofcode.org/articles/s/javascript-this">depende do contexto que se encontra</a>, ou seja, do objeto que está em execução naquele momento. Vejamos alguns exemplos:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>console.log(<span style="color:#ff79c6">this</span>) <span style="color:#6272a4">// window
</span></span></span><span style="display:flex;"><span>console.log(<span style="color:#ff79c6">this</span> <span style="color:#ff79c6">===</span> <span style="color:#8be9fd;font-style:italic">window</span>) <span style="color:#6272a4">// true
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> foo(string <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>){
</span></span><span style="display:flex;"><span>  console.log(<span style="color:#ff79c6">this</span>); <span style="color:#6272a4">// window
</span></span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span> <span style="color:#ff79c6">===</span> <span style="color:#8be9fd;font-style:italic">window</span> <span style="color:#6272a4">// true
</span></span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> el <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#39;my-el&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>el.addEventListener(<span style="color:#f1fa8c">&#39;click&#39;</span>, <span style="color:#8be9fd;font-style:italic">function</span>() {
</span></span><span style="display:flex;"><span>  console.log(<span style="color:#ff79c6">this</span> <span style="color:#ff79c6">===</span> el); <span style="color:#6272a4">// true
</span></span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Em um construtor, o <code>this</code> se refere ao objeto construído:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#ff79c6">class</span> MyClass {
</span></span><span style="display:flex;"><span>  constructor() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">this</span>.x <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">5</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> obj <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> MyClass();
</span></span><span style="display:flex;"><span>console.log(obj.x); <span style="color:#6272a4">// 5
</span></span></span></code></pre></div><p>E finalmente, em um objeto se refere ao próprio:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#ff79c6">const</span> obj <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>  fn<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> anotherObj <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">Object</span>.create(obj);
</span></span><span style="display:flex;"><span>anotherObj.foo <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>console.log(anotherObj.fn()); <span style="color:#6272a4">// { foo: 1 }
</span></span></span></code></pre></div><p>Então, podemos concluir que é uma faca de <em>dois legumes</em>, e pega muita gente. Mas capturar referências do objeto em execução muitas vezes pode simplificar coisinhas do cotidiano.</p>
<h2 id="arrays-feat-arrays">Arrays feat: arrays</h2>
<p>Observe o seguinte bloco código:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#ff79c6">const</span> movies <span style="color:#ff79c6">=</span> [
</span></span><span style="display:flex;"><span>  { id<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span>, name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Titanic&#34;</span>, year<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1997</span> },
</span></span><span style="display:flex;"><span>  { id<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">2</span>, name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Bastardos Inglórios&#34;</span>, year<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">2009</span> },
</span></span><span style="display:flex;"><span>  { id<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">3</span>, name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Laranja Mecânica&#34;</span>, year<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1971</span> },
</span></span><span style="display:flex;"><span>  { id<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">4</span>, name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Soul&#34;</span>, year<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">2021</span> },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> findByID(id) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> movies.find(item =&gt; item.id <span style="color:#ff79c6">===</span> id);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> findByName(name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> movies.filter(item =&gt; item.name.toLowerCase().includes(name.toLowerCase()));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> findBeforeYear(year) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> movies.filter(item =&gt; item.year <span style="color:#ff79c6">&lt;</span> year);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> findYear21Century() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> movies.find(item =&gt; item.year <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">2000</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Basicamente, uma lista de filmes que eu gosto muito e algumas funções que retorna uma versão filtrada da mesma lista, simples né? É a forma que geralmente implementamos <strong>mas</strong> e o <strong>reuso????</strong></p>
<p>Podemos reescrever uma das funções fazendo <em>curring</em>, assim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> byBeforeYear(year) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">function</span>(item){
</span></span><span style="display:flex;"><span>    item =&gt; item.year <span style="color:#ff79c6">&lt;</span> year
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>movies.find(byBeforeYear(<span style="color:#bd93f9">2000</span>))
</span></span></code></pre></div><p>Digamos que a montagem fica estranha, ainda mais porque confunde a cabecinha uma função retornando outra função, (não é, juninho?).</p>
<h2 id="fofoca-gosto">Fofoca? Gosto</h2>
<p>Talvez você nunca tenha reparado, mas os métodos de Array (map, find, filter,..) possuem um <strong>segundo parâmetro</strong> onde você pode dizer qual o valor do <code>this</code> quando chamamos uma função predicado. Ou seja:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>[].filter(<span style="color:#8be9fd;font-style:italic">function</span>(){
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">this</span>;  <span style="color:#6272a4">// &#39;foo&#39;
</span></span></span><span style="display:flex;"><span>}, <span style="color:#f1fa8c">&#39;foo&#39;</span>);
</span></span></code></pre></div><p>Hmm&hellip;. então podemos escrever coisas assim?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>movies.filter(<span style="color:#8be9fd;font-style:italic">function</span>(movie){
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> movie.year <span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">this</span>;
</span></span><span style="display:flex;"><span>}, <span style="color:#bd93f9">2000</span>)
</span></span></code></pre></div><p>Sim, dá certo. Ouuuu seja, podemos criar predicados mais reaproveitáveis e mais <strong>rápidos</strong>. Assim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> isBefore(movie){
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> movie.year <span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">this</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>movies.filter(isBefore, <span style="color:#bd93f9">2000</span>)
</span></span><span style="display:flex;"><span>movies.filter(isBefore, <span style="color:#bd93f9">1990</span>)
</span></span></code></pre></div><p>Não fica lindo? Pois é, só não é mais lindo que você, que tá lendo meu blogzin. Mas não só mais lindo como <em>mais rápido</em> em relação a função comum lá no início, se liga nesse <em>benchmark</em>:</p>
<p><img src="/images/screenshot-19-11-2002-0001.png" alt="Dobrou"></p>
<p>Bem melhor, né? Mas calma, só é mais rápido quando o <code>thisValue</code> for um <strong>Objeto</strong>, caso contrário o <em>Javasixpto</em> precisa converter antes e ai já viu né.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> byEquals(movie) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">const</span> key <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">Object</span>.keys(<span style="color:#ff79c6">this</span>)[<span style="color:#bd93f9">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> movie[key] <span style="color:#ff79c6">===</span> <span style="color:#ff79c6">this</span>[key];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> bySearch(movie) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">const</span> key <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">Object</span>.keys(<span style="color:#ff79c6">this</span>)[<span style="color:#bd93f9">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> movie[key].includes(<span style="color:#ff79c6">this</span>[key]);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> byBefore(movie) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">const</span> key <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">Object</span>.keys(<span style="color:#ff79c6">this</span>)[<span style="color:#bd93f9">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> movie[key] <span style="color:#ff79c6">&lt;</span> <span style="color:#ff79c6">this</span>[key];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> byAfter(movie) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">const</span> key <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">Object</span>.keys(<span style="color:#ff79c6">this</span>)[<span style="color:#bd93f9">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> movie[key] <span style="color:#ff79c6">&lt;</span> <span style="color:#ff79c6">this</span>[key];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// movies made in 2009
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> a <span style="color:#ff79c6">=</span> movies.find(byEquals, { year<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">2009</span> });
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Movie with id 1
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> b <span style="color:#ff79c6">=</span> movies.find(byEquals, { id<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span> });
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// movies with name includes &#34;Laranja&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> c <span style="color:#ff79c6">=</span> movies.find(bySearch, { year<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Laranja&#34;</span> });
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// movies before 2000
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> d <span style="color:#ff79c6">=</span> movies.find(byBefore, { year<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">2000</span> });
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// movies after 2000
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> e <span style="color:#ff79c6">=</span> movies.find(byAfter, { year<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">2000</span> });
</span></span></code></pre></div><p>Legal, não é? Só frisando que a discussão aqui não é sobre qual jeito é melhor ou pior, até porque é inútil discutir isso, cabe você <em>devinho</em> usar sua criatividade para aplicar isso. Só joguei a ideia no ar.</p>
<h2 id="menção-honrosa">Menção honrosa</h2>
<p>Durante os benchmarks que fiz descobri o quão rápida é a solução com <em>curring</em>, ainda mais rápida que a solução com o <code>thisValue</code>. Se liga:</p>
<p><img src="/images/Screenshot-2022-11-19-at-15.31.13.png" alt="Result"></p>
<p>Isso é tudo pessoal.</p>

		</section>

		<div class="post-tags">
			
			
			
		</div>
	</article>
</main>
<footer>
  <div class="footer-info">
    2026 · feito com <a href="https://gohugo.io">hugo</a> & hospedado por <a href="https://pages.cloudflare.com/" target="_blank">cloudflare pages</a>
  </div>
</footer>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-9MMLCJ5CMK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-9MMLCJ5CMK');
</script>

<script src="http://localhost:1313//js/main.js"></script>
</div>
    </body>
</html>
