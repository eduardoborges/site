---
import Base from '../layouts/Base.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts'))
  .filter(p => !p.data.draft && !p.data.hidden)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const formatDate = (date: Date) =>
  date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
---

<Base title="Eduardo" ogImage="/me.jpeg">
  <main>
    <div class="hero">
      <h1>Eduardo Borges<span class="hero-dot">.</span></h1>
      <p>
        Staff Engineer <strong>@</strong> <a href="https://www.solfacil.com.br" target="_blank" rel="noopener noreferrer">SolfÃ¡cil</a>,
        tornando a energia solar acessÃ­vel a todos os brasileiros.
        Antes disso, Staff Engineer <strong>@</strong> <a href="https://www.stone.co" target="_blank" rel="noopener noreferrer">Stone.Co</a>,
        revolucionando o mercado de pagamentos, crÃ©dito e bancÃ¡rio no Brasil.
      </p>
      <p><strong>Brasileiro. Baiano. <a href="https://pt.wikipedia.org/wiki/Vaqueiro" target="_blank" rel="noopener noreferrer">Ex-vaqueiro</a></strong>.</p>

      <div class="hero-links">
        <a href="https://linkedin.com/in/euduardoborges" target="_blank" rel="noopener noreferrer">linkedin</a>
        <span class="separator">Â·</span>
        <a href="https://github.com/eduardoborges" target="_blank" rel="noopener noreferrer">github</a>
      </div>
    </div>

    <p class="now-playing">
      ouvindo <a href="" id="last-played">bip bop carregando...</a>
      <small>Â· rastreado por lastfm</small>
    </p>

    <h2>postagens do blog</h2>
    <ul>
      {posts.map(post => (
        <li class="post">
          <a href={`/posts/${post.data.slug || post.id}`}>{post.data.title}</a>
          <time class="meta" datetime={post.data.date.toISOString()}>{formatDate(post.data.date)}</time>
        </li>
      ))}
    </ul>
  </main>

  <script>
    const el = document.getElementById("last-played") as HTMLAnchorElement;
    (async () => {
      try {
        const data = await fetch("https://tools.borges.workers.dev/recent-tracks").then(r => r.json());
        const track = data.recenttracks.track[0];
        el.innerText = `${String(track.name).toLowerCase()} - ${String(track.artist["#text"]).toLowerCase()}`;
        el.href = String(track.url);
      } catch {
        el.innerText = "[oops ðŸ˜”... something went wrong]";
      }
    })();
  </script>
</Base>
