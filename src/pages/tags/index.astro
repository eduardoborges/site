---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts')).filter(p => !p.data.draft);
const tagCount = new Map<string, number>();

for (const post of posts) {
  for (const tag of post.data.tags ?? []) {
    tagCount.set(tag, (tagCount.get(tag) || 0) + 1);
  }
}

const tags = [...tagCount.entries()].sort((a, b) => b[1] - a[1]);
---

<Base title="tags">
  <main>
    <h1 class="page-title">tags</h1>
    <ul class="tags">
      {tags.map(([tag]) => (
        <li><a href={`/tags/${tag}`}>{tag}</a></li>
      ))}
    </ul>
  </main>
</Base>
